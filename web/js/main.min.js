"use strict";var APP=APP||{};APP.config={updateUrl:"?controller=slide&action=get&id=%d",maxIdleSeconds:45},APP.Slide=function(e){this.id=e,this.init(e)},APP.Slide.prototype={registerEvents:function(){console.log("Register events for slide - "+this.id);var e=this;$(this.$refresh).on("click",function(t){t.preventDefault(),APP.ajax.updateSlide(e)})},refreshContent:function(){console.log("Refresh slider content with id - "+this.id),APP.ajax.updateSlide(this)},init:function(e){console.log("Init/reinit slide - "+this.id);var t=APP.$allSlides.filter("[data-id="+e+"]");this.$content=t.find(".slide__content"),this.$date=t.find(".slide__date"),this.$loader=t.find(".slide__loader"),this.$refresh=t.find(".slide__refresh"),this.registerEvents()}},APP.common={init:function(){APP.$allSlides=$(".slide"),APP.$fotorama=$(".fotorama-frame").on("fotorama:ready",function(e,t){for(var i in t.data){var o=t.data[i];console.log("Add frame with id = "+o.id),o.slide=new APP.Slide(o.id)}console.log("Add frame init complete. Total frames:"),console.log(t.data)}).on("fotorama:showend",function(e,t){if(t.activeFrame.slide){t.activeFrame.slide.init(t.activeFrame.id);var i=t.activeIndex,o=0==i?t.data.length-1:i-1;console.log("index to update - "+o),t.data[o].slide.refreshContent()}APP.idle=0}).fotorama(),APP.fotorama=APP.$fotorama.data("fotorama"),this.monitorActivity()},monitorActivity:function(){APP.idle=0;window.setInterval(function(){APP.idle++,console.log(APP.idle),APP.idle>APP.config.maxIdleSeconds&&(console.log("idle time on more then max idls - starts autoplay"),APP.fotorama.startAutoplay())},1e3)}},APP.ajax={updateSlide:function(e){e.$loader.addClass("-loading"),$.ajax({url:APP.config.updateUrl.replace("%d",e.id),method:"get",dataType:"json",success:function(t){console.log(t.refresh_date),e.$loader.removeClass("-loading"),e.$date.text(t.refresh_date),e.$content.html(t.html)}})}},jQuery(function(e){e(function(){APP.common.init()})});